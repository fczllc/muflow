<!--
 * @Description: 
 * @Author: tianyi
 * @Date: 2025-02-23 10:48:54
 * @LastEditors: tianyi
 * @LastEditTime: 2025-02-23 11:48:00
 * @FilePath: \muflow\feature.md
-->

# 流程图 Vue 组件设计方案

## 1. 功能详细要求

本组件旨在创建一个基于浏览器的交互式流程图编辑器，具备以下核心功能：

1. **可拖拽节点和连线绘制：**
   
   * 用户可以通过拖拽操作在画布上创建矩形节点控件。
   * 用户可以通过拖拽锚点的方式，在节点之间创建连线，形成流程图结构。

2. **线框样式设置：**
   
   * 允许用户自定义矩形节点控件的边框样式，包括：
     * **粗细：**  可调整边框线条的像素宽度。
     * **颜色：**  可选择边框线条的颜色。

3. **字体样式设置：**
   
   * 允许用户自定义节点和标签控件的字体样式，包括：
     * **大小：**  可调整字体大小。
     * **颜色：**  可选择字体颜色。

4. **连线样式设置：**
   
   * 允许用户自定义连线的样式，包括：
     * **粗细：**  可调整连线线条的像素宽度。
     * **颜色：**  可选择连线线条的颜色。
     * **线型：**  可选择实线、虚线、点线等线型。
     * **双端箭头：**  可设置连线两端是否显示箭头，以及箭头的样式。

5. **画布 JSON 保存与加载：**
   
   * **保存：**  提供 API 将当前画布上的所有节点、连线及其样式配置保存为 JSON 格式的文件。
   * **加载：**  提供 API 接收 JSON 文件或 JSON 字符串，解析并加载流程图到画布上，恢复流程图的结构和样式。

6. **清除画布功能：**
   
   * 提供按钮或 API，一键清除画布上的所有节点和连线，恢复画布为空白状态。

7. **文件标签控件：**
   
   * 创建一种特殊的"文件标签"控件，其特点是：
     * **无边框：**  默认不显示边框。
     * **无线连：**  不可与其他控件建立连线。
     * **字体样式设置：**  支持字体样式（大小、颜色）设置。
     * **自动回行：**  文本内容超出控件宽度时自动换行显示。

8. **控件连线操作：**
   
   * **锚点显示：**  当鼠标悬停在矩形控件上时，控件四条边的中心位置显示圆形锚点。
   * **拖拽连线：**  用户可以从锚点拖拽连线到另一个控件的锚点上，建立连接。
   * **智能连线：**  连线根据连接的锚点位置和对齐情况，自动选择圆角折线或直线。

9. **控件选中与大小调整：**
   
   * **单击选中：**  单击矩形控件，控件进入选中状态，周围显示八个小正方形锚点（四角和四边中心）。
   * **拖拽调整大小：**  拖动锚点可以改变矩形控件的尺寸。
   * **文字自适应：**  矩形控件内部的文字内容应根据控件大小自适应调整显示。
   * **样式设置：**  选中状态下，允许用户设置控件的样式（例如，背景色、边框样式等）。
   * **删除控件：**  选中控件后，按下 `Delete` 键可以删除选中的控件。

10. **其他辅助功能：**
    
    * **清除画布按钮：**  在界面上提供一个按钮，点击即可清除画布。
    * **多选对齐与分布：**  支持多选节点后进行对齐和分布操作：
      * **对齐：**  左对齐、右对齐、顶对齐、底对齐。
      * **分布：**  水平居中对齐、垂直居中对齐、水平均匀分布、垂直均匀分布。

## 2. 技术路线

本组件将基于 Vue Flow ([2](https://vueflow.dev/guide/),[3](https://vueflow.dev/guide/getting-started.html)) 开源库进行二次开发，并使用 Vue 3.4.19 版本和 TypeScript 进行开发。

* **Vue Flow 基础框架：**  Vue Flow 提供了流程图组件的核心功能，包括节点和连线的渲染、拖拽、缩放、事件处理等。我们将利用 Vue Flow 提供的组件和 API，构建流程图编辑器的基本框架。
* **Vue 3.4.19 和 TypeScript：**  使用 Vue 3.4.19 版本的 Composition API 进行组件开发，利用 TypeScript 的类型系统提高代码的可维护性和可读性。
* **自定义节点和连线：**  通过 Vue Flow 的 slot ([4](https://vueflow.dev/guide/vue-flow/slots.html)) 功能，自定义矩形节点、文件标签节点和连线的样式和交互行为。
* **状态管理：**  使用 Vue Flow 提供的 `useVueFlow` composable ([5](https://vueflow.dev/guide/composables.html)) 管理流程图的状态，包括节点、连线、选中状态等。
* **样式定制：**  利用 CSS 类、CSS 属性和 CSS 变量 ([6](https://vueflow.dev/guide/theming.html)) 定制组件的整体样式和各个元素的样式。
* **JSON 序列化与反序列化：**  使用 JavaScript 的 `JSON.stringify()` 和 `JSON.parse()` 方法，结合 Vue Flow 的 API，实现流程图数据的 JSON 保存和加载。
* **对齐和分布算法：**  自行实现或引入第三方库来实现节点的对齐和分布算法。
* **第三方库：**
  * **Vue Flow (@vue-flow/core):**  核心流程图库 ([7](https://vueflow.dev/guide/getting-started.html))。
  * **Dagre (可选):**  用于自动布局的库，如果需要自动布局功能可以考虑引入 ([9](https://vueflow.dev/examples/layout/simple.html),[10](https://vueflow.dev/examples/layout/animated.html))。

## 3. UI 布局说明

整个流程图编辑器页面将分为四个主要区域，布局大致如下：

<table>
<tr><td height=32>logo</td><td>样式设置工具(Top Style Toolbar)</td><td>画面操作工具(Top tool Toolbar)</td></tr>
<tr><td height=200>左侧流程控件栏</br>(left Sidebar)</td><td colspan="2" style='align:center'>主画布窗口<br>(Main Canvasr)</td></tr>
</table>



### 3.1. 顶部工具栏 (Top Toolbar)

顶部工具栏横跨页面顶部，分为左右两个区域：

- **顶部左上角**：logo图片
* **顶部左侧 - 样式设置工具(Top Style Toolbar)：**  包含用于设置节点和连线样式的工具，以图标形式呈现。
  
  * **线框样式设置：**  图标按钮，点击展开线框样式设置面板，允许用户设置节点边框的粗细和颜色。
  * **字体样式设置：**  图标按钮，点击展开字体样式设置面板，允许用户设置节点和标签控件的字体大小和颜色。

* **顶部右侧 - 画布操作工具(Top tool Toolbar)：**  包含用于画布操作的工具，以图标形式呈现。
  
  * **清除画布：**  图标按钮，点击清除画布上的所有节点和连线。
  * **导出图片：**  图标按钮，点击将当前画布内容导出为图片文件（例如 PNG 或 JPEG 格式）。
  * **保存画面：**  图标按钮，点击将当前画布数据保存为 JSON 文件。

### 3.2. 左侧流程控件栏 (Left Sidebar)

左侧控件栏位于页面左侧，垂直排列，包含可拖拽到画布上的流程控件，以图标形式呈现。

* **文字标签控件：**  图标按钮，代表文字标签控件，用户可以拖拽此图标到画布上创建文字标签节点。
* **圆角矩形节点控件：**  图标按钮，代表圆角矩形节点控件，用户可以拖拽此图标到画布上创建圆角矩形节点。

### 3.3. 主画布窗口 (Main Canvas)

主画布窗口占据页面主要区域，用于展示和编辑流程图。用户可以在此区域进行节点拖拽、连线绘制、节点编辑等操作。画布应具备：

* **网格背景 (可选)：**  可以考虑添加网格背景，辅助用户对齐节点。
* **滚动条：**  当流程图内容超出画布窗口大小时，显示滚动条，允许用户滚动查看整个流程图。
* **鼠标交互：**  响应鼠标事件，实现节点的选中、拖拽、连线、缩放等交互操作。

## 4. 开发计划

本组件的开发计划分为以下几个阶段：

* **第一阶段：静态 UI 页面实现 (预计 0.5 周)**
  
  * 根据 UI 布局说明和原型图 (您提供)，使用 HTML、CSS 和 Vue 组件搭建静态 UI 页面框架。
  * 实现顶部工具栏、左侧控件栏和主画布窗口的静态布局。
  * 使用图标占位符代替实际功能图标。
  * 不实现任何交互功能，仅完成静态页面结构。

* **第二阶段：环境搭建与 Vue Flow 集成 (预计 0.5 周)**
  
  * 搭建 Vue 3.4.19 + TypeScript 开发环境。
  * 安装 Vue Flow 核心库。
  * 在静态 UI 页面的主画布窗口区域集成 Vue Flow 组件。
  * 实现 Vue Flow 画布的基本渲染。

* **第三阶段：基础功能实现 (预计 1 周)**
  
  * 实现基本的矩形节点和连线拖拽绘制功能。
  * 实现节点的选中、拖动和删除功能。
  * 实现左侧控件栏的控件拖拽到画布上创建节点的功能。

* **第四阶段：样式定制与增强功能 (预计 2 周)**
  
  * 实现线框样式、字体样式和连线样式的设置功能 (与顶部工具栏的样式设置工具联动)。
  * 实现文件标签控件。
  * 完善控件连线操作，包括锚点显示、拖拽连线和智能连线。
  * 实现控件大小调整和文字自适应。
  * 实现双击编辑节点文字功能。

* **第五阶段：JSON 保存加载与辅助功能 (预计 1.5 周)**
  
  * 实现画布 JSON 保存和加载功能 (与顶部工具栏的保存画面和加载功能联动)。
  * 实现清除画布按钮和功能 (与顶部工具栏的清除画布功能联动)。
  * 实现导出图片功能 (与顶部工具栏的导出图片功能联动)。
  * 实现多选节点的对齐和分布功能。
  * 替换静态 UI 页面的图标占位符为实际功能图标，并完善 UI 交互细节。
  * 编写组件文档和示例。

* **第六阶段：测试与优化 (预计 0.5 周)**
  
  * 进行全面的功能测试和兼容性测试。
  * 修复 Bug 并进行性能优化。
  * 完善文档和示例。

**时间总计：约 6 周**

## 5. 组件输出形式

本组件将以 Vue 3 组件的形式输出，可以被其他 Vue 3 项目直接引用和使用。组件代码将包含：

* Vue 组件文件 (`.vue` 文件)。
* TypeScript 类型定义文件 (`.d.ts` 文件)。
* 样式文件 (`.css` 文件)。
* 组件文档 (`README.md` 文件)。

## 6. 后续扩展方向 (可选)

* **更多节点类型：**  支持更多类型的节点，例如圆形节点、菱形节点、自定义形状节点等。
* **分组功能：**  支持将多个节点组合成一个组，方便整体操作。
* **撤销/重做：**  添加操作历史记录，支持撤销和重做操作。
* **数据验证：**  支持对流程图数据进行验证，例如检查节点是否连接完整。
* **动态数据绑定：**  支持将节点和连线的数据与外部数据源进行绑定，实现动态更新。
* **流程图布局算法：**  集成自动布局算法，例如树状布局、力导向布局等，提高流程图的可读性。
